# 散户手动交易哲学：扫描器 + 盘感

> **核心洞见**
> 1. **扫描器不保证胜率**（无回测无优化），但它能让人专注在特定的行情结构和节奏中，从而让盘感不陷入混乱。**真正的赢面不是来自特定行情本身，而是来自被特定行情约束的盘感。**
> 2. **扫描器表达"何时有机会"，盘感表达"如何把握机会"**。两者缺一不可，主观与客观产生动态平衡，实现 1+1 > 2 的效果。
> 3. **适用全市场**：不管是期货、股票、外汇还是加密货币，只要是流动性强的主流市场都适用。
> 4. **扫描标准**：扫描器可以扫描各种行情（趋势、反转、震荡、背驰等），但该行情必须**足够特殊和极端**，且具备**多周期结构支撑**。大周期建议至少从**周线**级别开始确认，以保证结构的有效性。
> 5. **操作纪律**：盘感必须严格遵循扫描器给出的**行情性质**和**进场节奏**来看盘。扫描器没信号时，**所有时间均为垃圾时间**，不看盘，不操作。持仓后的离场，则必须严格按**规则**执行，杜绝随意性。


---


## 1. 强趋势共振策略：核心定义

### 1.1 三大核心策略总览

本系统只关注三种高结构的特定行情：**趋势、背驰、动量**。除此之外的所有震荡行情，一律视为垃圾时间。

| 策略 | 核心逻辑 | 典型机会 | 盈亏特征 |
| :--- | :--- | :--- | :--- |
| **策略一 (Trend)** | **强趋势共振**<br>顺大周期惯性，吃主升浪 | **“均线多头排列”**<br>周/日/时方向一致，CCI 强劲 | **胜率最高**，最稳健<br>容易吃到大肉 |
| **策略二 (Reversal)** | **极值背离**<br>物极必反，抓回调/反转 | **“涨不动了”**<br>周线多，日线背离，小时破位 | **速度最快**<br>抓恐慌盘/逼空盘，止损极小 |
| **策略三 (Momentum)** | **MACD 动能**<br>静极思动，抓起爆点 | **“刚睡醒”**<br>周线动能转强，价格突破 | **效率最高**<br>往往在趋势加速前抢跑入场 |

> **互补性**：
> *   **策略一**：吃**主升浪**（空间最大，胜率最高）。
> *   **策略二**：抓**恐慌盘**（速度最快，盈亏比最高）。
> *   **策略三**：抢**起爆点**（动能点火，效率极高）。
> *   **震荡**：**绞肉机**，坚决不碰。


---


### 1.2 策略一：强趋势共振 (Trend)

*(注：期货市场多空皆可做。下文为了描述方便, 统一以**做多**为例, 做空逻辑反之亦然。)*

> **不满足共振条件 = 垃圾时间, 无需看盘**

**典型场景 (以做多为例)：周线、日线、小时线均方向一致，CCI 数值强劲。**

| 周期 | 共振条件 ( `x>` 上穿, `>` 上方 ) |
|------|----------|
| **5分钟** | close `x>` EMA(触发进场) `OR` 开盘第一根阳线: close `>` EMA(触发进场) |
| **1小时** | (Diff - Dea) `>` 0 (红柱) `AND` close `>` EMA |
| **日线** | CCI `>` 30 `AND` close `>` EMA |
| **周线** | CCI `>` 80 `AND` close `>` EMA |

> **做空逻辑对称**：做空时条件与做多完全对称：
> - 5分钟：close `x<` EMA(触发进场) `OR` 开盘第一根阴线: close `<` EMA(触发进场)
> - 1小时：(Diff - Dea) `<` 0 (绿柱) `AND` close `<` EMA
> - 日线：CCI `<` -30 `AND` close `<` EMA
> - 周线：CCI `<` -80 `AND` close `<` EMA

> **澄清**：上述所有 `close` 均指**该K线已走完后的收盘价**, 而非盘中动态变化的最新价。

**特点**：最严格, 信号最少, 但胜率和盈亏比最高。周线 CCI > 80 确保宏观趋势已确立, 日线 CCI > 30 则进一步放宽以尽可能捕捉趋势延续中的所有机会——既然周线已经够强, 日线只需确保在常态区间上方即可。**在本体系中, 任何提高交易频率的调整, 都必须以不削弱周线级趋势许可为前提。**

> **为什么要严格区分 `x>` (上穿) 和 `>` (上方)？**
> *   **大周期 (小时/日/周) 是看方向的 (`>`)**：只要维持在上方, 说明大环境是顺风的, 就是安全的共振区域。
> *   **小周期 (5分钟) 是找买卖点的 (`x>`)**：必须精确锁定**启动的那一刻**。
>     *   如果 5分钟也是只要 `>` (在上方) 就可以交易, 就会失去节奏感, 变成随意的追涨杀跌, 导致交易混乱。
>     *   **`x>` 代表了有约束、有节奏的交易。** 只在刚刚启动的一瞬间入场, 过时不候。

> **辅助参考：大周期 ER (Efficiency Ratio / 趋势效率)**
> *   **观察**：如果 **大周期 ER < 30**, 说明大周期趋势可能偏弱或进入震荡。
> *   **对策**：**不改变当前所有进场规则和离场规则**。只是下调预期，建议 **5分钟 1:2 直接离场**，别拿太久。
> *   **逻辑**：ER (Efficiency Ratio) 衡量的是价格运动的"效率"和"纯度"。当 ER 偏低时（例如 < 30），说明价格虽然在涨，但过程曲折反复，趋势性差，Beta 回报密度下降。此时应主动降低预期，避免把短线行情强行当成中长趋势来持有。
> *   **注意**：ER 只是参考提示，不影响共振和买点判断。在程序算法中，**ER 不参与共振信号的生成逻辑**（不会因为 ER 低而过滤掉信号），也不影响方向判断。它仅仅计算并展示出来，供交易员人工决策"持有预期"时参考。


---


### 1.3 策略二：极值背驰 (Reversal)

**典型场景 (以做空为例 - 抓多头回调/见顶)**：
- **周线**：强势多头 (`CCI > 80` + `close > EMA`)。
- **日线**：高位背离 (`CCI > 80` + `close > EMA`)。虽然还在涨，但 K 线创新高而 CCI 不创新高（背离, 只检查最近10根）。
- **1小时**：动能转空 (`MACD 蓝柱`)。
- **5分钟**：共振杀跌 (`MACD 红转蓝(触发进场)` + `close < 5m EMA` + `close < 1h EMA` + `close > 日线 EMA`)。
    -   *逻辑*：如果价格已经跌破日线 EMA，说明回调幅度已深，盈亏比变差，不做；我们只吃**从背离确认到日线 EMA 支撑**这一段最肥的鱼身。

**预期目标**：
-   **核心目标**：抓取一波 **5分钟级别的最强流畅趋势**。因为背驰往往引发恐慌性抛盘/逼空，速度最快，效率最高。
-   **后续处理**：拿到第一波流畅利润后，看情况决定去留。若在日线 EMA 企稳则止盈；若直接击穿，则转为趋势单持有。


---


### 1.4 策略三：爆发动量 (Momentum)

> **核心逻辑**：捕捉 **MACD 动能周期** 的共振启动。利用 MACD 柱线（动能）的变化，在大周期动能刚转强、小周期刚起爆的瞬间进场。

**典型场景 (以做多为例)**：
- **周线**：动能转强 ((`MACD 柱线 蓝转红` OR `红柱变长`) + `k线收阳` + `close > 前一根close`)。K线连涨且动能增强，确认周线级别启动。
- **日线**：动能确认 (`MACD 红柱` + `close > EMA`)。确保日线处于可操作的多头区域。
- **1小时**：动能确认 (`MACD 零上红柱`)。确保小时级别处于强势多头区域，排除零下弱反弹。
- **5分钟**：价格突破 (`macd零上金叉/零上蓝转红(触发进场)`)。


---


### 1.5 [不为清单] 震荡 (Range / 均值回归)

> **定义**：大周期无方向，价格在区间内无序波动（上蹿下跳）。
> **对策**：**坚决不做！**
> **理由**：震荡行情是手动交易者的绞肉机。
> *   **难度极高**：均值回归策略对参数极其敏感，极其依赖回测优化（Quant 的领域），除非你是量化交易者并做过充分回测，否则不要碰。
> *   **手动必死**：震荡策略（均值回归）高度依赖参数优化。如果不优化参数，连好用的窗口都找不到，根本无法合理“策略化”，最终沦为随机下注。
> *   **保护心态**：强行做震荡会破坏顺势的盘感。主动放弃震荡利润，只吃最肥的鱼身（趋势/背驰/突破）。


---


## 2. 盘感的定位：被约束的执行者

### 2.1 盘感的真正作用

盘感是必要的，但是必须**被约束**。在混沌的市场中，裸奔的盘感是混乱的根源；但在扫描器界定的**特殊行情**和**特定节奏**下，盘感是最终扣动扳机的**执行者**。

| 状态 | 扫描器 (Scanner) | 盘感 (Intuition) | 结果 |
|------|------------------|------------------|------|
| **无约束** | ❌ (缺席) | 随意切换视角，试图解读所有波动 | 精神分裂，被噪音吞噬 |
| **有约束** | ✅ (构建秩序) | **在特定结构下，按特定节奏审视行情** | 专注，画龙点睛 |

> **关键定位**：
> *   **扫描器定义赛场与节奏**：它不仅划定了一个高纯度的博弈空间（如强趋势、极端背驰），还给出了具体的**进场节奏**（如 5m close x> ema）。
> *   **盘感负责猎杀**：在这个空间内，盘感负责感知微观的阻力、动能衰竭和入场时机。
> *   **没有扫描器，盘感是盲目的；没有盘感，扫描器是僵化的。**

### 2.2 进场环节的盘感：一票否决

**权限定义**：在进场环节，盘感只有**减法权**（不做），没有**加法权**（强做），更没有**修改权**（早做/晚做/强行做/反复做/反着做）。

1.  **不可干扰方向和节奏**：
    *   交易的方向和进场节奏，完全由策略规则死板定义 (扫描器程序化通知)。
    *   盘感**绝不可干扰**或试图修改这些硬性信号。

2.  **仅有的否决权**：
    *   当扫描器发出信号时，若盘感强烈觉得"不对劲" (如直觉到重大阻力位、形态震荡丑陋、极端暴涨暴跌)，**可以选择不做 (放弃该信号)**。
    *   **禁忌**：但**绝不能反着做**，也绝不能在无信号时**强行做**，或者被打止损后**反复做**。

3.  **禁止随意回补**：
    *   如果被打止损，**绝不能**因为"觉得还能涨"就随意再进场。
    *   必须耐心等待扫描器发出**下一次明确信号**。只能做规则给的买卖点。

4.  **禁止加仓与反手**：
    *   **一把梭逻辑**：开仓即决战。**绝不考虑任何加仓** (无论浮盈加仓还是亏损补仓) 和 **反手** 操作。
    *   **仓位管理**：开仓前就必须决定好最终仓位。保证金占资金比例应该在 **40%-60%**。如果小于这个比例, 可以多下几手, 直到符合比例, 如果超过这个比例, 哪怕机会再好也不开仓, 风控在进场前就计算好。

5.  **止损前置思维**：
    *   **止损位置**：一般放在**最小周期 (5分钟)** 附近的**分形影线**位置。如果是**大实体K线** (如长阳线/长阴线) k线走完后的收盘价进场，止损可以放在**该K线的实体中间**位置。
    *   **风控计算**：进场前必须计算潜在亏损额。单笔止损幅度应严格控制在**本金的 2% 左右**。
    *   **放弃原则**：如果技术止损位距离过远导致潜在亏损超过 2%，**直接放弃该机会，别进场**。风控必须在进场前就计算好。

### 2.3 离场环节的盘感：由僵化到优化

> **扫描器仅提示进场**：程序只负责发现机会, 不负责提示离场。离场由人来执行。

**规则核心：先僵化 (规则), 后优化 (盘感)。**

1.  **阶段一：硬性规则 (盈亏比 < 1:2)**
    *   **禁止离场**：只要价格没有触及止损线, 也没达到 1:2 的目标位, **绝对禁止手动平仓**。
    *   **禁止主动干预**：禁止离场, 禁止反手, 禁止离场后再进场, 禁止做T, **禁止任何主动操作** (只能被动接受止盈或止损)。
    *   **逻辑**：这是最难熬的阶段, 也是最容易因为"害怕利润回撤"而瞎操作的阶段。必须用死规则锁住手脚, 给趋势呼吸的空间。要么止损离场, 要么拿到基础利润。

2.  **阶段二：盘感接管 (盈亏比 > 1:2)**
    *   当利润已有安全垫 (达到 1:2) 时, 规则退场, **盘感介入**。
    *   **选择权**：
        *   **落袋为安**：盘感觉得行情乏力, 可以直接止盈。
        *   **博取长线**：盘感觉得趋势正猛 (如周线级别大爆发), 可以继续持有。
        *   **保本护航**：将止损移动到开仓价 (保本), 然后让利润奔跑, 追求 1:5 甚至更高。


---


## 3. 执行框架

### 3.1 垃圾时间管理

既然共振条件已经量化, 那么：
> **不满足共振条件的时间 = 垃圾时间 = 不看盘**

这让"物理冻结"从"强制不看盘"升级为"条件未触发=不看盘"——更加主动和优雅。

### 3.2 操作流程

```
1. 检查共振条件
   ├── 不满足 → 垃圾时间, 关闭软件
   └── 满足 → 进入看盘模式

2. 看盘模式
   ├── 自上而下观察（指数 → 品种）
   ├── 寻找买卖点
   └── 用盘感微调进场时机

3. 持仓管理
   ├── 顺势持有
   ├── 止损放在结构位
   └── 目标盈亏比 1:2 或更高
```

### 3.3 关键纪律

1. **永不逆风做单**：只做共振方向
2. **垃圾时间不看盘**：条件不满足就是休息时间
3. **顺势而为**：趋势是朋友, 不要试图逆势博取反转
4. **控制仓位**：期货自带杠杆, 仓位控制在 40%-60%

### 3.4 辅助工具：趋势共振扫描器

> **定位**：这是一个**单纯的行情扫描与通知工具**, 不进行自动交易, 也不进行回测。它的唯一目的是代替人工全天候盯盘, 将人从垃圾时间中解放出来。
>
> **这个是用来给手动交易用的, 虽然放在本项目, 但是和本项目的量化交易框架无关, 这个工具和本项目的其他模块保持互相独立**

**执行逻辑：**

1.  **定时扫描**：全天候定时扫描。
2.  **共振判断**：
    *   **技术标准**：严格按照 **方案一: 经典四周期共振** 计算指标和判断共振。
    *   **筛选策略**：严格按照 **1.3 共振强度分级** 进行过滤。
    *   **只通知 5星(最优解) 和 4星(次优解) 的机会**。
    *   **其他情况(垃圾时间)一律静默**, 屏蔽所有非共振噪音 (即使品种自身走强也不通知)。
3.  **结果输出**：打印日志并 **实时推送** 交易节奏 (5分钟是否上穿EMA)。

**关键设计细节补充：**

1.  **循环间隔与周期对齐**：
    *   循环间隔时间应严格等于**最小K线周期**（如配置为 5m, 则每 5分钟 循环一次）。
    *   该间隔必须**动态读取配置**, 禁止硬编码。
2.  **整点时刻触发与单次执行**：
    *   扫描动作必须卡在**整点**执行（5m的话, 例如 5:00, 5:05, 5:10...）。
    *   **严格单次触发**：每个小周期（如 5m）**只能触发一次**扫描。只有在检测到**整点切换后的第一次**数据更新时才执行扫描逻辑, 随后在当前周期内即刻锁定, 直到下一个整点周期到来。
    *   **实现技巧**：通过对比“当前获取的最新K线时间戳”与“内存中记录的上一轮已处理K线时间戳”是否不同。若不同（说明是新周期的第一次更新）, 则执行扫描并更新记录的时间戳；若相同（说明是同周期内的后续更新）, 则直接跳过, 防止重复扫描。
3.    *   **指标信号判定的"上一根原则"**：
    *   **规则**：严禁使用当前未收盘K线。必须锁定**上一根已完成K线 (`iloc[-2]`)** 作为判断对象, 以**上上根 (`iloc[-3]`)** 作为穿越基准。
    *   **强制实现**：代码必须使用 **`safe_iloc(series, -2)`** 工具函数来获取数据。该函数会在尝试访问 `-1` (未收盘K线) 时直接抛出异常，从而在代码层面强制杜绝未来函数的使用。
    *   **逻辑**：
        1.  **定义匹配**：策略要求的 "close > EMA" 是指 K 线走完后的最终收盘价。若用 `iloc[-1]` 判断, 实际用的是约等于当前开盘价, **逻辑错误**。
        2.  **避免失效**：所谓"上穿"是指**两个已走完的收盘价** (`close[-3]` vs `close[-2]`) 之间的状态跃迁。若拿 `iloc[-1]` (约等于当前开盘价) 和 `iloc[-2]` (上根收盘) 比较, 它们数值几乎相等(如果不跳空的话), 既违背了上穿定义, 也算不出任何信号。
        3.  **开盘第一根**：对于"开盘第一根阳线"策略, 同样必须等这根线走完（变身 `iloc[-2]`）后才能确认它是阳线且站上均线, 开盘瞬间无法确认。
    *   **示例**：
        ```python
        # 强制使用 safe_iloc，禁止直接 .iloc[-1]
        prev_close = safe_iloc(close, -2)       # ✅ 正确
        curr_close = safe_iloc(close, -1)       # ❌ 报错: 禁止访问未收盘K线

        # 确认"刚才那根已收盘K线"是否上穿
        is_cross_above = (safe_iloc(close, -2) > safe_iloc(ema, -2)) and \
                         (safe_iloc(close, -3) <= safe_iloc(ema, -3))
        ```
4.  **数据源限制与功能裁剪**：
    *   **现状**：目前天勤量化（TqSdk）数据源暂不支持获取实时的大盘/板块指数数据。
    *   **应对**：因此, **板块/大盘共振**功能相关字段标记为 `TODO`或`移除`, 当前版本**仅实现品种自身的共振检测**。
    *   **影响**：共振强度分级中, 原本依赖大盘共振的“5星”判定暂时无法自动输出, 均由人工后续确认, 程序只需准确输出“品种自身共振”的结果即可。


---


## 4. 历史演进

> 本文不是凭空出现的理论, 是过来人在长期经验中摸索出来的东西。

我的交易认知经历的迭代过程：

1. **蒙昧期**：胡乱操作, 被情绪牵着走。
2. **技术期**：迷信特殊形态与具体指标。
3. **结构期**：过度依赖历史结构, 对当下变化反应迟钝。
4. **过滤期**：试图用盘感一票否决, 但缺乏系统性。
5. **心流期**：承认盘感优势, 但忽视了现实摩擦的残酷性。
6. **污染期**：虽然意识到了持仓后的混乱（陷入盘感的无限纠偏）, 但将其错误地归结为认知偏差（变量污染）, 试图用心理学解释。
7. **约束期**：依然把盘感当作核心, 但看穿了手续费的摩擦成本, 建立了"全流程平衡"和"每日三眼法", 从而限制频繁交易和看盘频率。
8. **共振期**：通过实战的惨痛教训，彻底认清了 **Alpha 与 Beta** 的本质区别。意识到必须只做"强趋势共振"，利用市场的 beta 优势，而盘感只是锦上添花。然而，这种思维排除了所有震荡和回调和背驰策略，导致在非趋势行情中无所适从。
9. **平衡期 (扫描器+盘感)**：打破了"只能做强趋势"的思维枷锁，上升到了对**工具与人性**关系的本质认知。
    - **扫描器 (Context界定者)**：扫描器不负责预测，甚至不保证胜率（无回测）。它的核心价值是 **"构建秩序"** 和 **"过滤噪音"**。它用于快速界定出当下属于哪种典型的行情结构（无论是强趋势、还是典型震荡、还是极端背弛）。只要该结构足够显著、典型、少见，就可以被扫描出来。
    - **盘感 (Execution执行者)**：盘感不是用来在混沌中寻找方向的，而是用来**处理扫描器筛选出的特定机会**的。在扫描器构建的"高纯度"环境中，盘感用于捕捉入场时机、过滤假信号、感受动能强弱，从而实现画龙点睛。
    - **辩证关系**：
        - 用扫描器替代盘感 → 必然走向僵化，面对复杂博弈长期不可行（纯量化的死穴）。
        - 用盘感脱离扫描器 → 必然走向混乱，被市场噪音吞噬长期不可行（散户的死穴）。
        - **扫描器表达"何时有机会"，盘感表达"如何把握机会"。** 两者结合实现了主观与客观的动态平衡。

**最终形成**：
> **[秩序] 扫描器过滤(Context) + [灵性] 盘感执行(Execution) = 长期生存之道**
> *Machine limits the Context; Human kills the Target.*
