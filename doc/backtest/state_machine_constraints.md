# å•ä»“ä½å›æµ‹çŠ¶æ€æœºï¼šçº¦æŸä¸çŠ¶æ€æ¨æ–­

æœ¬æ–‡æ¡£è¯¦ç»†æè¿°**å•ä»“ä½å›æµ‹å¼•æ“**çŠ¶æ€æœºçš„æ ¸å¿ƒè®¾è®¡åŸç†ã€‚

## ç³»ç»Ÿç‰¹æ€§

- **å•ä»“ä½ç³»ç»Ÿ**ï¼šåŒä¸€æ—¶åˆ»åªèƒ½æŒæœ‰ä¸€ä¸ªæ–¹å‘çš„ä»“ä½ï¼ˆå¤šå¤´æˆ–ç©ºå¤´ï¼‰ï¼Œä¸æ”¯æŒåŒæ—¶æŒæœ‰å¤šç©º
- **å…¨ä»“æ¨¡å¼**ï¼šæ¯æ¬¡å¼€ä»“ä½¿ç”¨å…¨éƒ¨å¯ç”¨èµ„é‡‘ï¼Œæ— æ æ†
- **ä»·æ ¼é©±åŠ¨çŠ¶æ€**ï¼šä¸ä½¿ç”¨æ˜¾å¼ Position æšä¸¾ï¼Œè€Œæ˜¯é€šè¿‡ä»·æ ¼å­—æ®µç»„åˆæ¨æ–­çŠ¶æ€

---

## æ ¸å¿ƒå‘½é¢˜

> **æ•°æ®æ¸…æ´—çº¦æŸ + è¿è¡Œæ—¶é€»è¾‘çº¦æŸ = å¯ä¸¥æ ¼æ¨æ–­å• Bar å†…æ‰€æœ‰ä»“ä½çŠ¶æ€**

---

## 1. æœ¯è¯­åŒºåˆ†

> âš ï¸ **é‡è¦**ï¼šä¿¡å·ä¸ä»·æ ¼æ˜¯ä¸¤ä¸ªä¸åŒå±‚æ¬¡çš„æ¦‚å¿µï¼Œå¿…é¡»åŒºåˆ†æ¸…æ¥šã€‚

| å±‚æ¬¡ | å­—æ®µ | ç±»å‹ | æ¥æº |
|------|------|------|------|
| **ä¿¡å·å±‚** | `entry_long`, `exit_long` | `bool` | ç­–ç•¥ç”Ÿæˆï¼Œç»é¢„å¤„ç†æ¸…æ´— |
| **ä»·æ ¼å±‚** | `entry_long_price`, `exit_long_price` | `Option<f64>` | è¿è¡Œæ—¶æ ¹æ®ä¿¡å·+çº¦æŸè®¡ç®— |

- ä¿¡å·æ˜¯"æ„å›¾"ï¼šç­–ç•¥**æƒ³è¦**åšä»€ä¹ˆ
- ä»·æ ¼æ˜¯"ç»“æœ"ï¼šå¼•æ“**å®é™…æ‰§è¡Œ**äº†ä»€ä¹ˆ

çŠ¶æ€æšä¸¾åŸºäº**ä»·æ ¼å±‚**è€Œéä¿¡å·å±‚ã€‚

---

## 2. çº¦æŸä½“ç³»

### 2.1 æ•°æ®æ¸…æ´—çº¦æŸï¼ˆé¢„å¤„ç†é˜¶æ®µï¼‰

åœ¨ä¸»å¾ªç¯æ‰§è¡Œå‰ï¼Œé€šè¿‡ Polars Lazy API å¯¹**ä¿¡å·**è¿›è¡Œæ¸…æ´—ã€‚

| è§„åˆ™ | æ¡ä»¶ | å¤„ç† | ç›®çš„ |
|-----|------|------|------|
| R1 | `entry_long âˆ§ entry_short` | ä¸¤è€…éƒ½è®¾ä¸º `false` | ç¦æ­¢åŒæ—¶è¿›å…¥å¤šç©º |
| R2 | `entry_long âˆ§ exit_long` | `entry_long = false` | ç¦æ­¢è¿›å¤šåŒæ—¶å¹³å¤š |
| R3 | `entry_short âˆ§ exit_short` | `entry_short = false` | ç¦æ­¢è¿›ç©ºåŒæ—¶å¹³ç©º |
| R4 | `skip_mask = true` | è¿›åœºä¿¡å·å±è”½ | å›æ’¤æš‚åœ |
| R5 | `atr = NaN` | è¿›åœºä¿¡å·å±è”½ | ATR æ— æ•ˆä¿æŠ¤ |

**è¾“å‡ºä¿è¯**ï¼ˆä»¥ä¸‹ä¿¡å·ç»„åˆè¢«**æ‹’ç»**ï¼Œä¸ä¼šå‡ºç°ï¼‰ï¼š
```
âŒ entry_long âˆ§ entry_short   // è¢« R1 æ‹’ç»
âŒ entry_long âˆ§ exit_long     // è¢« R2 æ‹’ç»
âŒ entry_short âˆ§ exit_short   // è¢« R3 æ‹’ç»
```

---

### 2.2 è¿è¡Œæ—¶é€»è¾‘çº¦æŸï¼ˆä¸»å¾ªç¯é˜¶æ®µï¼‰

åœ¨ `BacktestState::calculate_position()` ä¸­ï¼Œä»£ç é€»è¾‘éšå«ä»¥ä¸‹çº¦æŸï¼š

| çº¦æŸ | ç›¸å…³æ–¹æ³•/é€»è¾‘ | æ•ˆæœ |
|------|-----------------|------|
| **ä»·æ ¼é‡ç½®** | `reset_long_state()` / `reset_short_state()` | ä¸Šä¸€ bar ç¦»åœºåé‡ç½®å¯¹åº”æ–¹å‘ä»·æ ¼ï¼Œç¡®ä¿ç¦»åœºåå¯è¿›å…¥æ–°ä»“ä½ |
| **è¿›åœºéœ€æ— ä»“ä½æˆ–åæ‰‹** | `can_entry_long() = has_no_position() \|\| is_exiting_short()` | ç¦æ­¢åŠ ä»“ã€ç¦æ­¢åŒæ—¶æŒæœ‰å¤šç©º |
| **ç¦»åœºéœ€æŒä»“** | `has_long_position()` æ—¶æ‰è®¾ç½® `exit_long_price` | ç¦æ­¢å¯¹ä¸å­˜åœ¨çš„ä»“ä½ç¦»åœº |
| **é£æ§ç¦»åœºè¦†ç›–ç­–ç•¥ç¦»åœº** | `!should_exit_in_bar_long()` æ¡ä»¶ | in_bar å·²å¹³ä»“åˆ™ä¸å† next_bar å¹³ä»“ |
| **é£æ§éœ€æŒä»“** | `check_risk_exit()` ä»…åœ¨ `has_long_position()` æ—¶è°ƒç”¨ | æ— ä»“ä½ä¸è§¦å‘é£æ§ |

**æ¨è®º**ï¼š
- `exit_long_price` å­˜åœ¨ â†’ `entry_long_price` å¿…å­˜åœ¨
- `exit_short_price` å­˜åœ¨ â†’ `entry_short_price` å¿…å­˜åœ¨
- ä¸å¯èƒ½åŒæ—¶æŒæœ‰å¤šç©ºä»“ä½
- æŒä»“æ—¶å¿½ç•¥åŒå‘è¿›åœºä¿¡å·
- æ— ä»“æ—¶å¿½ç•¥ç¦»åœºä¿¡å·

### 2.3 æ‰§è¡Œé¡ºåºï¼ˆå…³é”®è®¾è®¡ï¼‰

> [!IMPORTANT]
> åŒ bar æœ€å¤æ‚çš„åœºæ™¯æ˜¯ï¼šå…ˆå¹³ä»“ï¼ˆå¼€ç›˜ä»·ï¼‰â†’ å†åæ‰‹å¼€ä»“ï¼ˆå¼€ç›˜ä»·ï¼‰â†’ å†è§¦å‘é£æ§ç¦»åœºï¼ˆSL/TP ä»·ï¼‰
>
> å› æ­¤æ‰§è¡Œé¡ºåºå¿…é¡»æ˜¯ï¼š**å…ˆç¦»åœº â†’ åè¿›åœº â†’ æœ€å risk**

```
1. ä»·æ ¼é‡ç½®ï¼ˆä¸Šä¸€ bar ç¦»åœºå®Œæˆåæ¸…ç†ï¼‰
2. ç­–ç•¥ç¦»åœºæ£€æŸ¥ï¼ˆè®¾ç½® exit_priceï¼‰
3. ç­–ç•¥è¿›åœºæ£€æŸ¥ï¼ˆæ­¤æ—¶ is_exiting_*() å¯æ­£ç¡®è¿”å› trueï¼Œæ”¯æŒåæ‰‹ï¼‰
4. Risk ç¦»åœºæ£€æŸ¥ï¼ˆå¯¹æ–°å¼€ä»“ä½è¿›è¡Œé£æ§ï¼‰
```

**ä¸ºä»€ä¹ˆè¿™ä¸ªé¡ºåºæ˜¯æ­£ç¡®çš„**ï¼š

| æ­¥éª¤ | ä»·æ ¼ | è¯´æ˜ |
|------|------|------|
| ç­–ç•¥ç¦»åœº | å¼€ç›˜ä»· | å¹³æ‰ä¸Šä¸€æ ¹ K çº¿ä¿¡å·çš„ä»“ä½ |
| ç­–ç•¥è¿›åœº | å¼€ç›˜ä»· | æŒ‰ä¸Šä¸€æ ¹ K çº¿ä¿¡å·åæ‰‹å¼€ä»“ |
| Risk ç¦»åœº | SL/TP ä»· | å¯¹æ–°å¼€ä»“ä½è¿›è¡Œ in_bar é£æ§ |

è¿™ä¸ªé¡ºåºç¡®ä¿äº† `can_entry_long()` æ£€æŸ¥ `is_exiting_short()` æ—¶ï¼Œ`exit_short_price` å·²ç»è¢«è®¾ç½®ï¼Œä»è€Œæ­£ç¡®è§¦å‘åæ‰‹é€»è¾‘ã€‚

---

## 3. çŠ¶æ€æ¨æ–­

### 3.1 æœ‰æ•ˆçŠ¶æ€ç™½åå•

ç»è¿‡çº¦æŸè¿‡æ»¤åï¼Œ**åªæœ‰ä»¥ä¸‹ 15 ç§çŠ¶æ€æ˜¯åˆæ³•çš„**ã€‚ä»»ä½•ä¸åœ¨æ­¤åˆ—è¡¨ä¸­çš„çŠ¶æ€éƒ½æ˜¯éæ³•çš„ï¼Œä¼šåœ¨æµ‹è¯•ä¸­éªŒè¯ã€‚

> âš ï¸ **ç™½åå•æœºåˆ¶**ï¼šçŠ¶æ€æšä¸¾è¡¨æ˜¯**å…è®¸åˆ—è¡¨**ï¼Œä¸åœ¨åˆ—è¡¨ä¸­çš„ç»„åˆå‡ä¸ºéæ³•çŠ¶æ€ã€‚

| # | entry_L | exit_L | entry_S | exit_S | in_bar | first_entry | çŠ¶æ€ |
|:-:|:-------:|:------:|:-------:|:------:|:------:|:-----------:|------|
| 1 | âœ— | âœ— | âœ— | âœ— | 0 | 0 | `no_position` |
| 2 | âœ“ | âœ— | âœ— | âœ— | 0 | 0 | `hold_long` (å»¶ç»­) |
| 3 | âœ“ | âœ— | âœ— | âœ— | 0 | 1 | `hold_long_first` (è¿›åœº) |
| 4 | âœ— | âœ— | âœ“ | âœ— | 0 | 0 | `hold_short` (å»¶ç»­) |
| 5 | âœ— | âœ— | âœ“ | âœ— | 0 | -1 | `hold_short_first` (è¿›åœº) |
| 6 | âœ“ | âœ“ | âœ— | âœ— | 0 | 0 | `exit_long_signal` |
| 7 | âœ“ | âœ“ | âœ— | âœ— | 1 | 0 | `exit_long_risk` (æŒä»“å) |
| 8 | âœ“ | âœ“ | âœ— | âœ— | 1 | 1 | `exit_long_risk_first` (ç§’æ€) |
| 9 | âœ— | âœ— | âœ“ | âœ“ | 0 | 0 | `exit_short_signal` |
| 10| âœ— | âœ— | âœ“ | âœ“ | -1 | 0 | `exit_short_risk` (æŒä»“å) |
| 11| âœ— | âœ— | âœ“ | âœ“ | -1 | -1 | `exit_short_risk_first` (ç§’æ€) |
| 12| âœ“ | âœ“ | âœ“ | âœ— | 0 | -1 | `reversal_L_to_S` |
| 13| âœ“ | âœ— | âœ“ | âœ“ | 0 | 1 | `reversal_S_to_L` |
| 14| âœ“ | âœ“ | âœ“ | âœ“ | 1 | 1 | `reversal_to_L_risk` |
| 15| âœ“ | âœ“ | âœ“ | âœ“ | -1 | -1 | `reversal_to_S_risk` |

### 3.2 è¢«æ’é™¤çš„ç»„åˆï¼ˆç¤ºä¾‹ï¼‰

ä»¥ä¸‹æ˜¯éƒ¨åˆ†è¢«çº¦æŸæ’é™¤çš„ç»„åˆç¤ºä¾‹ã€‚ç”±äºç»„åˆæ•°é‡è¾ƒå¤šï¼Œæ— æ³•å®Œå…¨åˆ—ä¸¾ï¼Œæµ‹è¯•ä¸­ä½¿ç”¨ç™½åå•éªŒè¯ã€‚

| ç»„åˆ | æ’é™¤åŸå›  |
|------|----------|
| `(âœ“,âœ—,âœ“,âœ—)` | åŒæ—¶æŒæœ‰å¤šç©ºï¼Œè¿åå•ä»“ä½çº¦æŸ |
| `(âœ—,âœ“,âœ—,âœ—)` | å­¤ç«‹çš„ exit_long_priceï¼Œæ— å¯¹åº” entry |
| `(âœ—,âœ—,âœ—,âœ“)` | å­¤ç«‹çš„ exit_short_priceï¼Œæ— å¯¹åº” entry |
| `(âœ—,âœ“,âœ—,âœ“)` | ä¸¤ä¸ªå­¤ç«‹çš„ exitï¼Œæ— ä»»ä½• entry |

---

## 4. å®Œå¤‡æ€§è®ºè¯

### 4.1 å……åˆ†æ€§

**ç»™å®šä»»æ„æœ‰æ•ˆçš„è¿è¡Œæ—¶çŠ¶æ€ï¼Œå¿…ç„¶å¯ä»¥åœ¨ç™½åå•ä¸­æ‰¾åˆ°å”¯ä¸€åŒ¹é…ã€‚**

### 4.2 å¿…è¦æ€§

**ç™½åå•ä¸­çš„æ¯ä¸ªçŠ¶æ€éƒ½æ˜¯å¯è¾¾çš„ã€‚**

- çŠ¶æ€ 1-5ï¼šæ— ä»“ä½æˆ–æŒä»“çŠ¶æ€ï¼ˆno_positionã€hold_long/shortã€hold_long/short_firstï¼‰
- çŠ¶æ€ 6-11ï¼šç¦»åœºï¼ˆç­–ç•¥ç¦»åœºã€é£æ§ç¦»åœºã€ç§’æ€ç¦»åœºï¼‰
- çŠ¶æ€ 12-13ï¼šåæ‰‹è¿›åœºï¼ˆreversal_L_to_Sã€reversal_S_to_Lï¼‰
- çŠ¶æ€ 14-15ï¼šåæ‰‹ååŒ bar é£æ§ç¦»åœºï¼ˆreversal_to_L/S_riskï¼‰

---

## 5. è®¾è®¡å†³ç­–

### 5.1 çº¦æŸå³å¥‘çº¦

æ•°æ®æ¸…æ´—ä¸æ˜¯å¯é€‰çš„"ä¼˜åŒ–"ï¼Œè€Œæ˜¯çŠ¶æ€æœºæ­£ç¡®è¿è¡Œçš„**å‰ç½®å¥‘çº¦**ã€‚

### 5.2 çŠ¶æ€å³ä»·æ ¼

ä¼ ç»Ÿå›æµ‹ä½¿ç”¨æ˜¾å¼ `Position` æšä¸¾ï¼Œæœ¬å¼•æ“ä½¿ç”¨**ä»·æ ¼ç»„åˆ**æ¨æ–­çŠ¶æ€ã€‚

> ğŸ’¡ **è®¾è®¡åŠ¨æœº**ï¼š
>
> ä¼ ç»Ÿæ–¹æ¡ˆä½¿ç”¨ç¦»æ•£æšä¸¾ï¼ˆå¦‚ `Position::None | Long | Short`ï¼‰è¡¨ç¤ºä»“ä½çŠ¶æ€ã€‚ä½†å®è·µä¸­å‘ç°ï¼Œæšä¸¾ä¸ä»·æ ¼å­—æ®µä¹‹é—´å­˜åœ¨**çŠ¶æ€åŒæ­¥é—®é¢˜**ï¼š
>
> 1. **å†—ä½™å­˜å‚¨**ï¼šæšä¸¾æ˜¯çŠ¶æ€çš„"æ ‡ç­¾"ï¼Œè€Œ `entry_price`/`exit_price` æ˜¯çŠ¶æ€çš„"æ•°å€¼"ã€‚ä¸¤è€…å¿…é¡»åŒæ­¥æ›´æ–°ï¼Œå¦åˆ™äº§ç”Ÿä¸ä¸€è‡´ã€‚
> 2. **å¤æ‚è¾¹ç•Œ**ï¼šåœ¨åæ‰‹ã€é£æ§è§¦å‘ç­‰åœºæ™¯ä¸‹ï¼Œéœ€è¦åŒæ—¶ä¿®æ”¹æšä¸¾å’Œå¤šä¸ªä»·æ ¼å­—æ®µï¼Œææ˜“é—æ¼ã€‚
> 3. **è°ƒè¯•å›°éš¾**ï¼šæšä¸¾æ— æ³•ç›´æ¥è¾“å‡ºåˆ° DataFrameï¼Œéœ€è¦é¢å¤–è½¬æ¢ï¼›è€Œä»·æ ¼å­—æ®µå¤©ç„¶å¯åºåˆ—åŒ–ã€‚
>
> æœ¬å¼•æ“é‡‡ç”¨**ä»·æ ¼å³çŠ¶æ€**èŒƒå¼ï¼šå®Œå…¨ç§»é™¤ Position æšä¸¾ï¼Œé€šè¿‡ä»·æ ¼å­—æ®µç»„åˆæ¨æ–­çŠ¶æ€ã€‚è¿™å®ç°äº† **Single Source of Truth**ï¼ˆå•ä¸€æ•°æ®æºï¼‰ï¼Œæ¶ˆé™¤äº†çŠ¶æ€åŒæ­¥çš„å¤æ‚æ€§ã€‚

**ä¼˜åŠ¿**ï¼š
- **å¯å®¡è®¡**ï¼šDataFrame è¾“å‡ºå³å®Œæ•´çŠ¶æ€æ—¥å¿—
- **æ— åŒæ­¥é—®é¢˜**ï¼šä¸å­˜åœ¨æšä¸¾ä¸ä»·æ ¼ä¸ä¸€è‡´çš„ bug
- **è°ƒè¯•å‹å¥½**ï¼šç›´æ¥æŸ¥çœ‹ä»·æ ¼åˆ—å³å¯ç†è§£çŠ¶æ€æµè½¬
- **æµ‹è¯•ç®€å•**ï¼šåªéœ€éªŒè¯æ¯è¡ŒçŠ¶æ€æ˜¯å¦åœ¨ç™½åå•å†…å³å¯

### 5.3 `in_bar_direction` ä¸ `first_entry_side` çš„å¿…è¦æ€§

- **`in_bar_direction`** (i8): æ ‡è®°**ç¦»åœº**æ¨¡å¼ã€‚0=Next-Bar, 1=å¤šå¤´In-Bar, -1=ç©ºå¤´In-Barã€‚
- **`first_entry_side`** (i8): æ ‡è®°**è¿›åœº**æ¨¡å¼ã€‚0=æ— è¿›åœº, 1=å¤šå¤´è¿›åœº, -1=ç©ºå¤´è¿›åœºã€‚

**æ¨æ–­é€»è¾‘**ï¼š
- ç”¨æˆ·é€šè¿‡ `exit_long_price` ä¸” `in_bar_direction == 1` è¯†åˆ«é£æ§ç¦»åœºã€‚
- ç”¨æˆ·é€šè¿‡ `entry_long_price` å­˜åœ¨ä¸” `first_entry_side == 1` è¯†åˆ«å¤šå¤´è¿›åœº Barï¼Œæ— éœ€ä½¿ç”¨ `shift(1)` æ¯”è¾ƒã€‚
- **â€œç§’æ€â€åœºæ™¯æ¨æ–­**ï¼ˆå³è¿›å³å‡ºï¼‰ï¼š
  * ä¾‹å¦‚ï¼ˆå¤šå¤´ï¼‰`first_entry_side == 1` ä¸” `in_bar_direction == 1`ï¼ŒåŒæ—¶ `entry_long_price` å’Œ `exit_long_price` å‡å­˜åœ¨æ—¶ï¼Œè¡¨ç¤ºå‘ç”Ÿäº†æç«¯é£æ§åœºæ™¯ã€‚

---

## 6. æ€»ç»“

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   åŸå§‹ä¿¡å·      â”‚ â”€â”€â–¶ â”‚   æ•°æ®æ¸…æ´—      â”‚ â”€â”€â–¶ â”‚   æ— å†²çªä¿¡å·    â”‚
â”‚  (å¯èƒ½å†²çª)     â”‚     â”‚  (æ‹’ç»éæ³•ç»„åˆ) â”‚     â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                        â”‚
                                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 15 ç§åˆæ³•çŠ¶æ€   â”‚ â—€â”€â”€ â”‚   ä»·æ ¼å­—æ®µç»„åˆ  â”‚ â—€â”€â”€ â”‚   è¿è¡Œæ—¶çº¦æŸ    â”‚
â”‚   (ç™½åå•)      â”‚     â”‚ + in_bar_dir    â”‚     â”‚ (ä»“ä½è®¡ç®—é€»è¾‘)  â”‚
â”‚                 â”‚     â”‚ + first_entry   â”‚     â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```


## 7. æµ‹è¯•è¦†ç›–

15 ç§çŠ¶æ€å‡æœ‰å¯¹åº”çš„è‡ªåŠ¨åŒ–æµ‹è¯•éªŒè¯å…¶åˆæ³•æ€§ã€‚

### æµ‹è¯•æ–‡ä»¶

| æ–‡ä»¶ | è¯´æ˜ |
|-----|------|
| [test_state_whitelist.py](file:///home/hxse/pyo3-quant/py_entry/Test/backtest/common_tests/test_state_whitelist.py) | ç™½åå•éªŒè¯ï¼šæ£€æµ‹æ¯è¡ŒçŠ¶æ€æ˜¯å¦åœ¨ 15 ç§åˆæ³•çŠ¶æ€ä¸­ |
| [test_price_driven_state.py](file:///home/hxse/pyo3-quant/py_entry/Test/backtest/common_tests/test_price_driven_state.py) | ä»·æ ¼é©±åŠ¨çŠ¶æ€æ¨æ–­é€»è¾‘æµ‹è¯• |

### è¿è¡Œæµ‹è¯•

```bash
just test py_entry/Test/backtest/common_tests/test_state_whitelist.py
just test py_entry/Test/backtest/common_tests/test_price_driven_state.py
```
