# 交易哲学与系统设计白皮书

> **核心宗旨**：这是一套专为**散户翻身**设计的最佳实践，而非大公司理念的人云亦云。利用小资金的灵活性与高杠杆，通过非对称博弈（Asymmetric Betting）捕捉短期市场红利，并将利润转化为长期无风险资产。

---

## 1. 核心哲学：散户的非对称博弈论

传统的机构风控理论（追求 20 年稳健、低杠杆、低回撤）是为“大资金”设计的枷锁，对于资金量较小的个人投资者（Retail Investor），盲目模仿机构无异于**主动降低利润**和**浪费时间**。
*   **理念差异**：散户小资金与机构大资金的玩法本质上不同，不能人云亦云。机构追求稳健是为了保住饭碗，散户追求高增长是为了改变命运。

本系统的设计基于以下核心认知：

### 1.1 哑铃策略 (Barbell Strategy)
我们将资产配置两极化，拒绝中庸：
*   **左端（进攻）**：小资金（如 1 个月工资） x 极高杠杆 x 激进策略。利用 Crypto 或高波动市场的短期非有效性，追求 10 倍、100 倍的爆发性增长。
*   **右端（防守）**：大资金（利润转移） x 无杠杆 x 长期持有。将进攻端赚取的超额利润提取一部分，存入纳斯达克指数基金或高股息资产，享受复利。
*   **中间地带**：不仅不碰，而且要极力避免那些“低不成高不就”的平庸策略。

### 1.2 接受爆仓作为“经营成本”
*   小资金的优势在于**船小好调头**和**可承受归零**。
*   **初始资金定义**：建议使用**不超过一个月工资**（如 3000 元）作为初始本金。这是真正“不怕爆仓”的心理安全线。
*   对于激进账户，爆仓不是失败，而是为了获取超额收益所支付的必然成本。只要 **(总提取利润 + 剩余残值) > 投入本金总额**，系统就是盈利的。
*   **双层风控**：用小资金账户控制**绝对风险**，用风控离场（SL, TP, TSL）或指标离场（如 SMA 交叉）控制**相对风险**。两层结合，在拉高杠杆的同时保持风险可控——这并非矛盾，而是**带风控的激进策略**。

### 1.3 利润收割机制 (Profit Harvesting)
既然策略终将失效，系统唯一的目标就是**在失效前把肉带离餐桌**：
*   **本金抽离**：虽名为“抽本”，但因为初始本金很小（如 3000 元），重点不在于保本，而在于心态建设。
*   **利润大挪移**：真正的核心是**大额利润提取**。例如用 3000 元赚到了 30,000 元，应提取 10,000 元（甚至是本金的数倍）放入股市。
*   **定期分红 (Dividend Payout)**：每翻倍一次，就切掉一大块利润转移至“右端”安全账户。坚决不搞“滚雪球直到爆炸”，而是“滚出的雪球不断搬回家”。

### 1.4 为什么散户能具有长期优势？

本系统的四个支柱共同构建了散户的**可持续竞争力**：

| 支柱 | 作用 | 为什么散户能做到 |
|------|------|------------------|
| **真正的 Alpha** | 策略基于市场结构（如三重滤网、均值回归），而非偶然拟合 | 散户没有信息优势，但能专注于纯技术分析 |
| **最大安全杠杆** | 基于回撤计算可承受杠杆，加速资本积累 | 机构受限于合规和客户预期，散户无此束缚 |
| **小资金账户** | 绝对风险可控，爆仓不伤筋骨，防御黑天鹅 | 机构爆仓 = 倒闭，散户爆仓 = 重来 |
| **哑铃配置** | 利润转移至无风险资产，享受复利 | 进攻端和防守端完全解耦，不要求一起成功 |
| **快速迭代** | 行情变化后及时淘汰过时策略，研发新策略 | 机构僵化容易埋没天才，散户无此束缚 |

**核心逻辑**：散户的长期优势不是来自“永不失效的策略”，而是来自“快速迭代的能力”。策略是消耗品，但方法论是传家宝。


### 1.5 Alpha 的时效性

> **Alpha 不是永恒的**。真正的 Alpha 是对*当前*市场结构的洞察，而非对*永恒*规律的发现。市场结构变了，Alpha 就失效了——这不是策略设计的失败，而是市场的本质。

*   **经验法则**：基于过去 2 年的数据寻找 Alpha 结构，预期策略有效期约为半年到一年。
*   **何时失效？** 判断市场结构何时变化、策略何时该淘汰，往往要基于经验和天赋。本文只是哲学引导，不试图给出硬指标。
---

## 2. 交易方法论：快进快出与多维过滤

### 2.1 拒绝长周期历史
*   **短视是美德**：只回测近 2-3 年的数据。10 年前的数据代表的是旧的市场结构（Regime），对高增长策略不仅无用，甚至是噪音。
*   **必然规律**：回测近期数据虽然能得到高回报，但**策略生命周期也会变短**。这是高增长的代价。
*   **动态迭代**：如果策略在近半年表现不佳，直接废弃。不寻求修复，寻求替代。系统必须支持快速且持续的策略研发。

### 2.2 三重滤网 (Triple Screen)
利用多周期架构提高胜率，而非追求单次交易的完美：
*   **大周期**：判断趋势（如周线/日线趋势）。
*   **中周期**：寻找波段（如 4H 均值回归）。
*   **小周期**：精确入场（如 1hm 突破）。

#### 为什么不用马丁网格？
同样是"吃行情"的短生命周期策略，为什么选择三重滤网而非马丁网格（Martingale Grid）？

核心问题不是"能不能提取利润"或"风险大不大"，而是：**有没有真正的盈利能力？**

*   **真正的长期可持续优势 = 洞察市场底层逻辑的策略 + 跟随市场动态迭代策略**

*   **澄清「长期优势」**：这里的「长期」指的是**迭代能力的长期**，而非单个策略的长期有效性。散户的长期优势来源于：
    *   能够持续理解市场结构变化
    *   能够快速研发并替换失效策略
    *   掌握可复用的方法论（如三重滤网框架），而非固守某个具体参数组合

*   **三重滤网**：
    *   基于**市场的分形结构**——大中小周期共振反映了不同资金规模参与者的真实行为。
    *   这是对市场底层逻辑的真正洞察，是**真正的 Alpha**。
    *   市场结构变了？可以重新设计策略逻辑，保持长期优势。

*   **均值回归**：
    *   基于价格偏离均值后会回归的统计规律，同样有市场逻辑支撑。
    *   三重滤网和均值回归都适合散户，因为都有对市场底层逻辑的洞察，都可以动态迭代策略。

*   **马丁网格**：
    *   **对市场逻辑的洞察为零**。只是赌"价格一定会回来"，没有任何市场结构支撑。
    *   马丁的"优势"只是**把爆仓延后了**，这不是真正的优势，而是时间差幻觉。
    *   无法动态迭代——没有逻辑可调，爆了就是爆了。

*   **马丁 + 哑铃策略？**：
    *   看起来似乎可以在爆仓前提取利润，但这仍然是幻觉。
    *   不能用哑铃策略的分散风险能力，去掩盖马丁策略没有真正长期盈利能力的问题。这是塑造幻觉。

*   **Calmar 的真实性**：
    *   三重滤网和均值回归的 Calmar 是**真实的风险调整收益**，反映策略捕捉市场结构的能力。
    *   马丁的 Calmar 是**幻觉**——回测期内没遇到极端单边行情的假象。

*   **结论**：马丁策略太傻瓜了，不是一个能够把握市场底层逻辑、动态迭代的交易系统。长期搞下去，必死无疑。

### 2.3 纯技术驱动
*   **核心原则**：散户很难拥有机构级别的信息优势和深度基本面分析能力，应专注于纯粹的技术分析（TA）。
*   **硬件限制**：散户的网络环境一般，不适合做高频交易（HFT）或剥头皮（Scalping）。本系统专注于中短线波段。
*   不听消息，不追热点。完全基于价格行为（Price Action）和量化指标（TA）做交易决策。
*   利用 ADX 等指标识别趋势/震荡状态，动态规避垃圾行情。
*   **数据来源极简主义**：只用 OHLCV 和基于 OHLCV 计算的 TA 指标（如 SMA、ATR、ADX）。不搞订单流数据（Order Flow）、深度基本面数据，这些数据成本太高，不适合散户。

### 2.4 宏观基本面：了解大势，不研究细节

> **原则**：应该了解最宏观的基本面，但不该研究细节。

本系统虽然是纯技术驱动，但并非对世界一无所知。我们需要掌握**宏观层面的市场认知**，用于**筛选交易标的**，而非用于判断买卖点。

*   **需要了解的宏观信息**：
    *   **市场分类**：区分主流市场（BTC、ETH）、新兴市场（SOL 等）、小众市场、山寨币等
    *   **标的特征**：流动性、波动性、交易量级别——选择流动性好、波动性适中的标的
    *   **历史基准**：股票市场的历史平均年化回报率（约 7-10%）、加密市场的周期特征等
    *   **宏观周期**：基于历史大周期价格, 进行牛熊周期、减半周期等大势判断（但不用于择时）

*   **不需要研究的细节**：
    *   公司财报、项目白皮书、团队背景
    *   链上数据、持仓分布、巨鲸动向
    *   社区情绪、推特热度、KOL 喊单
    *   宏观经济指标的精确解读（CPI、非农等）

*   **边界总结**：
    *   ✅ 宏观认知 → 用于**选择在哪个市场交易**（前置筛选）
    *   ❌ 细节研究 → 不用于**判断何时买卖**（交易决策）
    *   **具体买卖点完全依赖技术分析**，这是不可动摇的原则。

### 2.5 关于机器学习的定位
*   **纯机器学习找买卖点？不行**：只会陷入无意义的噪音，没有市场逻辑支撑。
*   **机器学习的正确用法**：做行情过滤器（区分趋势/震荡），在已有效的策略（如三重滤网）上**锦上添花**，不要全指望机器学习。
*   **大语言模型？用不着**：LLM 适合基本面分析、社区情绪分析，但我们是纯 TA 策略。散户也没成本去搞 LLM，机器学习都得轻量优先。

### 2.6 高级数学过滤器：比 ML 和 ADX 更好的选择
对于行情过滤（区分趋势/震荡），散户有比机器学习和传统 ADX 更好的选择：

*   **代表指标**：
    *   赫斯特指数（Hurst Exponent）：判断市场是趋势、随机还是均值回归
    *   考夫曼自适应过滤器（Kaufman AER / KAMA）：根据市场噪音自动调整灵敏度

*   **为什么比机器学习更好**：
    *   规则明确，避免黑箱问题
    *   可解释性强，便于迭代
    *   性能成本更轻量

*   **为什么比传统 ADX 更好**：
    *   数学基础更扎实（分形理论、自适应理论）
    *   对行情状态的识别更精准
    *   作为过滤器能**明显提高策略效果**

*   **定位**：这些高级过滤器是三重滤网和均值回归等策略的**最佳搭档**——在已有效的策略逻辑上锦上添花，过滤掉垃圾行情。

### 2.7 为何放弃"基于净值曲线的暂停系统"

曾经考虑过一种设计：当净值曲线低于 EMA 时减少仓位或暂停交易，高于EMA的时候恢复, 这需要二次回测实现。**最终选择放弃**。

#### 设计思路（已废弃）
- 第一次回测：获取完整净值曲线
- 根据净值曲线计算 EMA，判断每根 K 线是否应该暂停
- 第二次回测：根据暂停标记调整仓位

#### 放弃原因：缺乏因果解释力

| 过滤方法 | 逻辑基础 | 可解释性 |
|----------|----------|----------|
| 赫斯特指数 | 市场处于无趋势/震荡状态 → 趋势策略不适用 | ✅ 因果清晰 |
| 净值曲线暂停 | 策略最近亏钱了 → 暂停交易 | ⚠️ 只是相关性 |

*   **无法区分原因**：净值下跌可能因为：
    *   市场不适合当前策略（合理暂停）
    *   策略本身存在缺陷（问题被掩盖）
    *   短期随机波动（过度反应）

*   **套娃式优化**：暂停系统是"策略的策略"，对市场本身没有任何理解增量。

*   **过拟合风险**：
    *   垃圾策略 + 暂停系统 → 回测变好看
    *   但很可能只是恰好躲过了几笔亏损（巧合）
    *   回测好看 ≠ 未来表现好

*   **变废为宝的错觉**：如果一个傻瓜式的方法就能让策略"变废为宝"，大概率是曲线拟合而非真正的改进。

#### 结论

**优先使用基于市场状态的过滤器**（如赫斯特指数、考夫曼自适应过滤器），而非基于策略表现的暂停系统。

*   前者回答："市场现在适不适合这个策略？"
*   后者回答："这个策略最近赚没赚钱？"

第一个问题有因果逻辑，第二个问题只是相关性。我们追求的是**对市场的真正洞察**，不是对自身表现的自我循环。

---

## 3. 技术架构映射：为理念量身打造

`pyo3-quant` 系统不是一个通用的回测框架，它是一个**高增长策略的孵化器**。所有的技术选型都服务于上述哲学。

### 3.1 为什么是 Rust?
*   **极致并发**：为了在短时间内找到**近几年有效的行情模式**，我们需要对海量参数进行网格/随机搜索。Rust 的无锁并发能力支持我们在单机上跑满所有 CPU 核心。
*   **安全的高性能**：**拒绝 Python 核心**。所有的回测计算、指标计算、风控逻辑全部在 Rust 层完成，Python 仅作为胶水语言。这意味着极致的性能和内存安全。

### 3.2 矢量化与单仓位设计
*   **默认无杠杆回测**：回测系统默认不加杠杆，专注于验证策略的纯逻辑有效性（Alpha）。这保证了数据的纯净性。
*   **策略堆叠 (Stacking)**：
    1.  **单体多模式**：支持在单个回测中通过指标（如 ADX）区分不同行情（Trend/Range），调用不同的逻辑，但本质依然是单仓位输出（1, 0, -1）。
    2.  **多体撮合**：也可以运行多个独立的单仓位策略回测，最终在**实盘交易机器人**端进行净头寸撮合（Netting）。这是最灵活的扩展方式。

### 3.3 核心数学引擎：杠杆与优化的闭环
这是本系统最精华的设计，直接服务于“高增长”目标：

#### A. MaxSafeLeverage (最大安全杠杆)
我们不问“我要上多少倍杠杆”，我们问“基于历史回撤，我能 **安全地** 上多少倍杠杆”。
*   **公式**：$$ Leverage = \frac{SafetyFactor}{MaxDrawdown} $$
*   **逻辑**：如果回测 MDD 是 10%，设定的安全系数是 0.8（激进模式，允许回撤本金的 80%），那么实盘杠杆 = 8倍。即使 MDD 是 20%，杠杆依然有 4 倍。
*   **哲学意义**：它将 **策略逻辑 (Alpha)** 与 **风险承载 (Beta)** 解耦。策略只需负责把曲线做平滑（减小 MDD），系统会自动奖励更高的杠杆，从而实现几何级数的收益增长。

#### B. Calmar Priority (卡尔马优先)
为了配合上述杠杆模型，优化器 **建议的最优先目标** 是 **卡尔马比率 (Calmar Ratio)**。
*   **公式**：$$ Calmar = \frac{AnnualReturn}{MaxDrawdown} $$
*   **为什么不是夏普 (Sharpe)**？夏普比率惩罚上行波动（暴涨），而我们要的正是非对称的暴涨。
*   **闭环流程**：
    1.  **优化目标**：最大化 Calmar Ratio（这会自动压低 MDD 同时拉高 Return）。
    2.  **中间产物**：得到一个经优化的、相对较小的 MDD。
    3.  **计算杠杆**：将此 MDD 代入 $$ SafetyFactor / MDD $$ 公式，计算出实盘能承受的**最大安全杠杆**。
    4.  **实盘部署**：直接使用该杠杆上线。
*   **结论**：在小资金激进体系下，Calmar 不仅仅是一个评价指标，它是**通往高杠杆实盘的唯一钥匙**。

### 3.4 策略模版系统
*   **热更新**：设计了 JSON/Python 配置化的 `SignalTemplate`。修改策略逻辑**不需要重新编译 Rust 核心**，这对于高频迭代的散户至关重要。
*   **参数分离**：参数与逻辑解耦，为未来的**全局随机搜索（Global Random Search）**优化器打好基础。

### 3.5 排除过拟合与验证

对于短生命周期激进策略，我们对过拟合有**独到的理解**：

#### A. 参数层面 vs 策略逻辑层面
*   **参数过拟合**：指的是选取了只在历史数据上好看的参数值。**向前测试/滚动优化已经足够排除**这个问题。
    *   **为什么足够？** 向前测试的核心机制是：在历史数据的「训练期」上优化参数，然后在随后的「测试期」（样本外数据）上验证表现。如果参数是过拟合的，它在样本外数据上的表现会显著恶化，从而被淘汰。
    *   滚动优化（Rolling Optimization）反复进行这个过程，模拟实盘中不断适应新行情的真实场景，确保策略在**未见过的数据**上也能盈利。
    *   这正是向前测试优于普通回测的核心——它用真实的「未来数据」检验过拟合，而非仅仅在历史数据上自我验证。
*   **策略逻辑过拟合**：指的是策略本身的逻辑结构只适用于特定行情。但对于我们的体系来说，这**不是问题**——因为我们的策略**本就是为了吃特定行情**而设计的，生命周期本来就短。

#### B. 吃行情 > 鲁棒性
*   **大资金的恐惧**：机构资金害怕行情变化，才拼命追求"万金油"策略，导致牺牲锐度换取鲁棒性。
*   **小资金的自由**：我们不追求万金油。一味追求什么行情都能赚的策略，只会塑造出**平庸**。
*   **短生命周期哲学**：策略失效了就废弃，研发新策略即可。策略是**消耗品**，不是**传家宝**。

#### C. 为什么拒绝蒙特卡罗和自举法？
*   **核心矛盾**：蒙特卡罗测试（Monte Carlo）和自举法（Bootstrap）会**打乱数据顺序**，假设样本独立同分布（i.i.d.）。
*   **趋势策略不适用**：我们的策略往往需要跟随大周期方向（Trend Following）。一旦打乱顺序，趋势结构就被破坏了，测试结果毫无意义。
*   **替代方案**：向前测试（Walk-Forward）才是正道——它保留了时间序列的趋势结构，同时验证策略的样本外表现。

#### D. 从源头减少过拟合
*   **策略简单**：这里「简单」指的是**逻辑层面简单**，而非参数数量少。
    *   **逻辑简单**：策略的核心规则应该能够用一两句话说清楚（如「大周期顺势，小周期入场」）。
    *   **参数存在的意义**：三重滤网需要多个周期、多个均线参数，这些参数是**逻辑的具体化表达**，不是凭空添加的复杂度。
    *   **过拟合的真正来源**：不是参数多，而是**逻辑牵强**——比如「周三下午 2 点如果价格在 VWAP 上方 1.3% 就做多」这种没有市场逻辑支撑的规则。
*   **策略合理**：逻辑必须有金融学意义，而非纯粹的数据挖掘。"因为历史上这个数字好看"不是理由；"因为这个逻辑在市场结构上成立"才是理由。

#### E. 向前测试 (Walk-Forward)
*   我们只相信滚动时间窗口的实战模拟。
*   **动态再优化**：在每个滚动窗口（Rolling Window）中，都会**重新优化一遍参数**。这模拟了实盘中不断适应新行情的真实过程，确保策略始终保持"动态"和"鲜活"。

---

## 4. 经验性法则：无法量化的交易智慧

> 以下法则**无法量化、无法教条**，只能在实践中感悟。

**为什么依赖经验？** 因为有些东西本质上无法量化、难以量化，过度工程化只会适得其反。金融行业是高精尖行业，提升自身的专业素养和交易直觉，本身就是核心能力的一部分。我们追求的是**长期优势**，而不是绝对可控——金融行业不存在绝对可控。

**量化的边界**：
*   **可量化**：策略回测、参数优化、风控指标、向前测试
*   **不可量化**：策略失效判断、策略迭代与淘汰时机、利润提取时机、爆仓后反思、市场选择

与其把不可量化的东西**硬量化**（往往导致过拟合或分散精力），不如承认它们需要**交易员自身的经验和天赋**。

*   **连续爆仓要反思**：是参数过拟合，还是策略逻辑太想当然？还是行情变化? 先找根因，再行动。
*   **策略失效的判断**：何时废除策略没有绝对标准，只能凭经验。
*   **加密市场选择**：选不大不小的币种（如 ETH、SOL），可能更有 Alpha。不要选山寨币，太嘈杂、规律性差。
*   **加密货币回测周期参考**：回测近 2-3 年的历史长度为佳。三重滤网周期建议：日线（大周期）、4 小时（中周期）、1 小时（小周期）。
*   **小周期定义**：股市用 15m，加密货币因 7×24 交易建议用 1h，减少数据压力且效果差不多。
*   **量化执行，减少干预**：机器人执行策略，人工只监控策略生命周期和行情变化。干预越少，心态越好。何时介入无法量化，不可教条。
*   **用策略找市场**：不要假设所有市场都有规律。用合理策略（如三重滤网、均值回归）去筛选市场，而非针对市场设计奇怪策略——后者极易过拟合。
*   **简单策略不过拟合**：策略合理（如三重滤网、均值回归）+ 向前测试 = 不会过拟合。不要搞乱七八糟的奇怪策略。
*   **借鉴社区策略**：可以尝试复制别人的策略（如社区分享），省去从零设计的成本，但仍需用向前测试验证其有效性。
*   **回测手续费悲观预估**：回测时手续费最好设高一些，悲观预估可以包含潜在的价差、滑点、网络波动等隐性成本。
*   **哑铃策略的利润分配**：从激进策略的利润中拿多少钱、什么时候拿、放到稳健资产多少？没有定数，只能凭经验。不要过度工程化。

---

## 5. 总结：小资金的生存之道

> **"小资金+低利润 = 浪费时间"**

本系统的核心使命是**效率**：
1.  **研发效率**：Rust + Python 混合架构，快速编写，极速回测。
2.  **资金效率**：高杠杆 + 激进风控，让每一分钱都在前线冲锋。
3.  **生命效率**：通过利润收割，尽快完成资本原始积累，从而进入“钱生钱”的从容阶段。

这是一套属于**进攻者**的系统。
